<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:models="clr-namespace:Foodbook.Models"
             xmlns:vm="clr-namespace:Foodbook.ViewModels"
             xmlns:converters="clr-namespace:Foodbook.Converters"
             xmlns:resources="clr-namespace:FoodbookApp.Localization"
             x:Class="Foodbook.Views.ShoppingListDetailPage"
             x:Name="ThisPage"
             x:DataType="vm:ShoppingListDetailViewModel"
             Title="{x:Static resources:ShoppingListDetailPageResources.Title}">
    <ContentPage.Resources>
        <converters:InvertedBoolConverter x:Key="InvertedBoolConverter" />
    </ContentPage.Resources>
    
    <ScrollView>
        <StackLayout Padding="10" Spacing="15">
            
            <!-- Sekcja: Produkty do kupienia -->
            <StackLayout Spacing="5">
                <Label FontSize="18"
                       FontAttributes="Bold"
                       TextColor="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource PrimaryDark}}"
                       Margin="0,0,0,10">
                    <Label.FormattedText>
                        <FormattedString>
                            <Span Text="ðŸ›’ "/>
                            <Span Text="{x:Static resources:ShoppingListDetailPageResources.ToBuy}"/>
                        </FormattedString>
                    </Label.FormattedText>
                </Label>
                
                <!-- NagÅ‚Ã³wki kolumn dla produktÃ³w do kupienia -->
                <Grid ColumnDefinitions="Auto,2*,Auto,Auto,Auto" 
                      Padding="5" 
                      ColumnSpacing="5" 
                      BackgroundColor="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource PrimaryDark}}">
                    <Label Grid.Column="0" Text="âœ“" FontAttributes="Bold" TextColor="White" VerticalTextAlignment="Center" HorizontalTextAlignment="Center" />
                    <Label Grid.Column="1" Text="{x:Static resources:ShoppingListDetailPageResources.NameHeader}" FontAttributes="Bold" TextColor="White" VerticalTextAlignment="Center" />
                    <Label Grid.Column="2" Text="{x:Static resources:ShoppingListDetailPageResources.QuantityHeader}" FontAttributes="Bold" TextColor="White" VerticalTextAlignment="Center" HorizontalTextAlignment="Center" />
                    <Label Grid.Column="3" Text="{x:Static resources:ShoppingListDetailPageResources.UnitHeader}" FontAttributes="Bold" TextColor="White" VerticalTextAlignment="Center" HorizontalTextAlignment="Center" />
                    <Label Grid.Column="4" Text="{x:Static resources:ShoppingListDetailPageResources.ActionsHeader}" FontAttributes="Bold" TextColor="White" VerticalTextAlignment="Center" HorizontalTextAlignment="Center" />
                </Grid>
                
                <!-- Lista produktÃ³w do kupienia -->
                <CollectionView ItemsSource="{Binding UncheckedItems}">
                    <CollectionView.ItemTemplate>
                        <DataTemplate x:DataType="models:Ingredient">
                            <Border Stroke="LightGray" StrokeThickness="1" Padding="5" Margin="0,2">
                                <Grid ColumnDefinitions="Auto,2*,Auto,Auto,Auto" ColumnSpacing="5">
                                    <CheckBox Grid.Column="0" IsChecked="{Binding IsChecked}" />

                                    <!-- Nazwa skÅ‚adnika -->
                                    <Entry Grid.Column="1" 
                                           Text="{Binding Name}" 
                                           Placeholder="Nazwa" />

                                    <!-- IloÅ›Ä‡ -->
                                    <Entry Grid.Column="2" 
                                           Text="{Binding Quantity}" 
                                           Keyboard="Numeric" 
                                           WidthRequest="60"
                                           HorizontalTextAlignment="Center" />

                                    <!-- Jednostka -->
                                    <Picker Grid.Column="3" 
                                            WidthRequest="80" 
                                            ItemsSource="{Binding BindingContext.Units, Source={x:Reference ThisPage}}" 
                                            SelectedItem="{Binding Unit}" />

                                    <!-- Przycisk usuwania -->
                                    <Button Grid.Column="4" 
                                            Text="ðŸ—‘" 
                                            Command="{Binding BindingContext.RemoveItemCommand, Source={x:Reference ThisPage}}" 
                                            CommandParameter="{Binding .}" 
                                            WidthRequest="40" 
                                            HeightRequest="40"
                                            BackgroundColor="Red"
                                            TextColor="White"
                                            FontSize="16"
                                            CornerRadius="6" />
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>
                
                <Button Command="{Binding AddItemCommand}" Margin="0,10,0,0">
                    <Button.Text>
                        <FormattedString>
                            <Span Text="{x:Static resources:ShoppingListDetailPageResources.AddItem}" />
                        </FormattedString>
                    </Button.Text>
                </Button>
            </StackLayout>

            <!-- Separator -->
            <BoxView HeightRequest="1" 
                     BackgroundColor="{AppThemeBinding Light={StaticResource Gray300}, Dark={StaticResource Gray600}}" 
                     Margin="0,10" />

            <!-- Sekcja: Produkty zebrane -->
            <StackLayout Spacing="5">
                <Label FontSize="18"
                       FontAttributes="Bold"
                       TextColor="{AppThemeBinding Light={StaticResource Gray500}, Dark={StaticResource Gray400}}"
                       Margin="0,0,0,10">
                    <Label.FormattedText>
                        <FormattedString>
                            <Span Text="âœ… "/>
                            <Span Text="{x:Static resources:ShoppingListDetailPageResources.Collected}"/>
                        </FormattedString>
                    </Label.FormattedText>
                </Label>
                
                <!-- NagÅ‚Ã³wki kolumn dla produktÃ³w zebranych -->
                <Grid ColumnDefinitions="Auto,2*,Auto,Auto,Auto" 
                      Padding="5" 
                      ColumnSpacing="5" 
                      BackgroundColor="{AppThemeBinding Light={StaticResource Gray300}, Dark={StaticResource Gray600}}">
                    <Label Grid.Column="0" Text="âœ“" FontAttributes="Bold" TextColor="White" VerticalTextAlignment="Center" HorizontalTextAlignment="Center" />
                    <Label Grid.Column="1" Text="{x:Static resources:ShoppingListDetailPageResources.NameHeader}" FontAttributes="Bold" TextColor="White" VerticalTextAlignment="Center" />
                    <Label Grid.Column="2" Text="{x:Static resources:ShoppingListDetailPageResources.QuantityHeader}" FontAttributes="Bold" TextColor="White" VerticalTextAlignment="Center" HorizontalTextAlignment="Center" />
                    <Label Grid.Column="3" Text="{x:Static resources:ShoppingListDetailPageResources.UnitHeader}" FontAttributes="Bold" TextColor="White" VerticalTextAlignment="Center" HorizontalTextAlignment="Center" />
                    <Label Grid.Column="4" Text="{x:Static resources:ShoppingListDetailPageResources.ActionsHeader}" FontAttributes="Bold" TextColor="White" VerticalTextAlignment="Center" HorizontalTextAlignment="Center" />
                </Grid>
                
                <!-- Lista produktÃ³w zebranych -->
                <CollectionView ItemsSource="{Binding CheckedItems}">
                    <CollectionView.ItemTemplate>
                        <DataTemplate x:DataType="models:Ingredient">
                            <Border Stroke="{AppThemeBinding Light={StaticResource Gray300}, Dark={StaticResource Gray600}}" 
                                    StrokeThickness="1" 
                                    Padding="5" 
                                    Margin="0,2"
                                    BackgroundColor="{AppThemeBinding Light=#F8F8F8, Dark=#2A2A2A}">
                                <Grid ColumnDefinitions="Auto,2*,Auto,Auto,Auto" ColumnSpacing="5">
                                    <CheckBox Grid.Column="0" IsChecked="{Binding IsChecked}" />

                                    <!-- Nazwa skÅ‚adnika - przekreÅ›lona -->
                                    <Label Grid.Column="1" 
                                           Text="{Binding Name}" 
                                           TextDecorations="Strikethrough" 
                                           TextColor="{AppThemeBinding Light={StaticResource Gray500}, Dark={StaticResource Gray400}}"
                                           VerticalTextAlignment="Center" />

                                    <!-- IloÅ›Ä‡ - przekreÅ›lona -->
                                    <Label Grid.Column="2" 
                                           Text="{Binding Quantity}" 
                                           TextDecorations="Strikethrough" 
                                           TextColor="{AppThemeBinding Light={StaticResource Gray500}, Dark={StaticResource Gray400}}" 
                                           VerticalTextAlignment="Center"
                                           HorizontalTextAlignment="Center" />

                                    <!-- Jednostka - przekreÅ›lona -->
                                    <Label Grid.Column="3" 
                                           Text="{Binding Unit}" 
                                           TextDecorations="Strikethrough" 
                                           TextColor="{AppThemeBinding Light={StaticResource Gray500}, Dark={StaticResource Gray400}}" 
                                           VerticalTextAlignment="Center"
                                           HorizontalTextAlignment="Center" />

                                    <!-- Przycisk usuwania -->
                                    <Button Grid.Column="4" 
                                            Text="ðŸ—‘" 
                                            Command="{Binding BindingContext.RemoveItemCommand, Source={x:Reference ThisPage}}" 
                                            CommandParameter="{Binding .}" 
                                            WidthRequest="40" 
                                            HeightRequest="40"
                                            BackgroundColor="Red"
                                            TextColor="White"
                                            FontSize="16"
                                            CornerRadius="6" />
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>
                
                <!-- Informacja gdy brak zebranych produktÃ³w -->
                <Label Text="{x:Static resources:ShoppingListDetailPageResources.NoCollected}"
                       TextColor="{AppThemeBinding Light={StaticResource Gray400}, Dark={StaticResource Gray500}}"
                       HorizontalTextAlignment="Center"
                       Margin="0,20"
                       IsVisible="{Binding HasCheckedItems, Converter={StaticResource InvertedBoolConverter}}" />
            </StackLayout>
            
        </StackLayout>
    </ScrollView>
</ContentPage>
