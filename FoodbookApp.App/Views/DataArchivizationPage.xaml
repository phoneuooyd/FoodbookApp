<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:loc="clr-namespace:Foodbook.Services"
             xmlns:views="clr-namespace:Foodbook.Views"
             x:Class="Foodbook.Views.DataArchivizationPage"
             x:DataType="views:DataArchivizationPage"
             Title="{loc:Translate Resource=DataArchivizationPageResources, Key=Title}"
             BackgroundColor="{DynamicResource PageBackgroundColor}">
    <ScrollView>
        <VerticalStackLayout Padding="20" Spacing="16">
            <Label Text="{loc:Translate Resource=DataArchivizationPageResources, Key=HeaderTitle}" FontSize="22" FontAttributes="Bold" HorizontalTextAlignment="Center" />
            <Label Text="{loc:Translate Resource=DataArchivizationPageResources, Key=HeaderDescription}" FontSize="12" HorizontalTextAlignment="Center" />

            <!-- Default folder info -->
            <Frame Padding="10" BackgroundColor="{AppThemeBinding Light=#F5F5F5, Dark=#2B2B2B}" CornerRadius="8">
                <VerticalStackLayout Spacing="10">
                    <Label Text="{loc:Translate Resource=DataArchivizationPageResources, Key=DefaultFolderLabel}" FontSize="12" />
                    <Label x:Name="DefaultFolderPathLabel" FontSize="11" TextColor="{AppThemeBinding Light=#666, Dark=#CCC}" LineBreakMode="CharacterWrap" />

                    <!-- Custom name input for archive file -->
                    <VerticalStackLayout Spacing="4">
                        <Label Text="{loc:Translate Resource=DataArchivizationPageResources, Key=ArchiveNameLabel}" FontSize="12" />
                        <Border StrokeThickness="1" Stroke="{AppThemeBinding Light=#E0E0E0, Dark=#404040}" StrokeShape="RoundRectangle 8">
                            <Entry x:Name="ArchiveNameEntry"
                                   Placeholder="{loc:Translate Resource=DataArchivizationPageResources, Key=ArchiveNamePlaceholder}"
                                   TextColor="{AppThemeBinding Light=Black, Dark=White}"
                                   BackgroundColor="Transparent"
                                   Margin="8,2" />
                        </Border>
                    </VerticalStackLayout>

                    <!-- Row 1: two primary actions -->
                    <HorizontalStackLayout Spacing="8">
                        <Button Text="{loc:Translate Resource=DataArchivizationPageResources, Key=RefreshList}" HeightRequest="36" Clicked="OnRefreshListClicked" BackgroundColor="{DynamicResource Primary}" TextColor="White" />
                        <Button x:Name="CreateArchiveButton" Text="{loc:Translate Resource=DataArchivizationPageResources, Key=CreateArchiveButton}" BackgroundColor="{DynamicResource Primary}" TextColor="White" HeightRequest="36" Clicked="OnExportClicked" />
                    </HorizontalStackLayout>
                    <!-- Row 2: manual search button -->
                    <HorizontalStackLayout Spacing="8">
                        <Button x:Name="ManualSearchButton"
                                Text="{loc:Translate Resource=DataArchivizationPageResources, Key=SearchArchivesButton}"
                                HeightRequest="36"
                                Clicked="OnManualSearchClicked"
                                Loaded="OnManualSearchButtonLoaded"
                                BackgroundColor="{DynamicResource Primary}"
                                TextColor="White" />
                    </HorizontalStackLayout>
                </VerticalStackLayout>
            </Frame>

            <!-- List of archives in default folder -->
            <Label Text="{loc:Translate Resource=DataArchivizationPageResources, Key=ArchivesInFolder}" FontAttributes="Bold"/>
            <CollectionView x:Name="ArchivesCollection" HeightRequest="240">
                <CollectionView.EmptyView>
                    <Label Text="{loc:Translate Resource=DataArchivizationPageResources, Key=NoArchivesFound}" FontSize="12" TextColor="Gray" />
                </CollectionView.EmptyView>
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Grid ColumnDefinitions="*,Auto,Auto" Padding="6" BackgroundColor="{AppThemeBinding Light=White, Dark=#1F1F1F}" Margin="0,3" >
                            <VerticalStackLayout>
                                <Label Text="{Binding FileName}" FontSize="13" />
                                <Label Text="{Binding ModifiedDisplay}" FontSize="11" TextColor="Gray" />
                            </VerticalStackLayout>
                            <Button Grid.Column="1"
                                    Style="{StaticResource RestoreButton}"
                                    ImageSource="redo.png"
                                    CommandParameter="{Binding FullPath}"
                                    Clicked="OnRestoreFromListClicked" />
                            <Button Grid.Column="2" Style="{StaticResource DeleteButton}" CommandParameter="{Binding FullPath}" Clicked="OnDeleteFromListClicked" />
                        </Grid>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

            <!-- Status label -->
            <Label x:Name="StatusLabel" FontSize="12" HorizontalTextAlignment="Center" />
        </VerticalStackLayout>
    </ScrollView>
</ContentPage>
