<?xml version="1.0" encoding="utf-8" ?>
<ContentView xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="Foodbook.Views.Components.UniversalListItemComponent"
             x:Name="ItemComponent">

    <ContentView Style="{StaticResource ListItemContainer}">
        <Frame Style="{StaticResource ListItemFrame}">
            <Frame.GestureRecognizers>
                <TapGestureRecognizer Command="{Binding EditCommand, Source={x:Reference ItemComponent}}" 
                                      CommandParameter="{Binding .}" />
            </Frame.GestureRecognizers>
            <Grid Style="{StaticResource ListItemContentGrid}" ColumnDefinitions="*,Auto,Auto">
                <!-- Item content column -->
                <StackLayout Grid.Column="0" Spacing="2">
                    <Label Text="{Binding Name}" Style="{StaticResource ItemTitleLabel}" 
                           IsVisible="{Binding ShowNutritionLayout, Source={x:Reference ItemComponent}}" />
                    
                    <!-- Plan Title - for Plan mode -->
                    <Label Text="{Binding Label}" Style="{StaticResource ItemTitleLabel}"
                           IsVisible="{Binding ShowPlanLayout, Source={x:Reference ItemComponent}}" />
                    
                    <!-- Subtitle (quantity and unit) - only visible for ingredients -->
                    <Label Style="{StaticResource ItemSubtitleLabel}"
                           IsVisible="{Binding ShowSubtitle, Source={x:Reference ItemComponent}}">
                        <Label.Text>
                            <MultiBinding StringFormat="{}{0:F1} {1}">
                                <Binding Path="Quantity" />
                                <Binding Path="Unit" />
                            </MultiBinding>
                        </Label.Text>
                    </Label>
                    
                    <!-- Plan Date Info - for Plan mode -->
                    <StackLayout IsVisible="{Binding ShowPlanLayout, Source={x:Reference ItemComponent}}" Spacing="2">
                        <Label Text="{Binding StartDate, StringFormat='Od: {0:dd.MM.yyyy}'}" 
                               FontSize="14" 
                               TextColor="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource PrimaryDark}}"
                               Margin="0,2,0,0" />
                        <Label Text="{Binding EndDate, StringFormat='Do: {0:dd.MM.yyyy}'}" 
                               FontSize="14" 
                               TextColor="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource PrimaryDark}}" />
                    </StackLayout>
                    
                    <!-- Nutrition info in horizontal layout - for Recipe/Ingredient mode -->
                    <StackLayout Style="{StaticResource NutritionContainer}"
                                 IsVisible="{Binding ShowNutritionLayout, Source={x:Reference ItemComponent}}">
                        <Label Style="{StaticResource CaloriesLabel}">
                            <Label.Text>
                                <MultiBinding StringFormat="{}{0:F0} kcal">
                                    <Binding Path="Calories" />
                                </MultiBinding>
                            </Label.Text>
                        </Label>
                        <Label Style="{StaticResource MacroLabel}">
                            <Label.Text>
                                <MultiBinding StringFormat="P: {0:F1}g">
                                    <Binding Path="Protein" />
                                </MultiBinding>
                            </Label.Text>
                        </Label>
                        <Label Style="{StaticResource MacroLabel}">
                            <Label.Text>
                                <MultiBinding StringFormat="F: {0:F1}g">
                                    <Binding Path="Fat" />
                                </MultiBinding>
                            </Label.Text>
                        </Label>
                        <Label Style="{StaticResource MacroLabel}">
                            <Label.Text>
                                <MultiBinding StringFormat="C: {0:F1}g">
                                    <Binding Path="Carbs" />
                                </MultiBinding>
                            </Label.Text>
                        </Label>
                    </StackLayout>
                </StackLayout>
                
                <!-- Archive button - for Plan mode -->
                <Button Grid.Column="1" 
                        Command="{Binding ArchiveCommand, Source={x:Reference ItemComponent}}" 
                        CommandParameter="{Binding .}" 
                        WidthRequest="35" 
                        HeightRequest="35"
                        BackgroundColor="{AppThemeBinding Light=#E6F3FF, Dark=#2C4A6B}"
                        BorderColor="{AppThemeBinding Light=#CCE6FF, Dark=#4A6B8A}"
                        BorderWidth="1"
                        CornerRadius="17"
                        Padding="0"
                        IsVisible="{Binding ShowArchiveButton, Source={x:Reference ItemComponent}}">
                    <Button.ImageSource>
                        <FileImageSource File="save.png" />
                    </Button.ImageSource>
                </Button>
                
                <!-- Delete button - for Recipe/Ingredient mode -->
                <Button Grid.Column="2" 
                        Style="{StaticResource DeleteButton}"
                        Command="{Binding DeleteCommand, Source={x:Reference ItemComponent}}" 
                        CommandParameter="{Binding .}"
                        IsVisible="{Binding ShowDeleteButton, Source={x:Reference ItemComponent}}" />
            </Grid>
        </Frame>
    </ContentView>

</ContentView>