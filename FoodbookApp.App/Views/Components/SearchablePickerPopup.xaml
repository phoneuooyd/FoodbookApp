<?xml version="1.0" encoding="utf-8" ?>
<mct:Popup xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
           xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
           xmlns:mct="clr-namespace:CommunityToolkit.Maui.Views;assembly=CommunityToolkit.Maui"
           xmlns:loc="clr-namespace:Foodbook.Services"
           x:Class="Foodbook.Views.Components.SearchablePickerPopup"
           x:Name="ThisPopup"
           CanBeDismissedByTappingOutsideOfPopup="True"
           Padding="0"
           Margin="0">

    <Border BackgroundColor="{DynamicResource PageBackgroundColor}"
            StrokeShape="RoundRectangle 12"
            StrokeThickness="1"
            Stroke="{DynamicResource Secondary}"
            MinimumWidthRequest="300"
            MaximumWidthRequest="500"
            MinimumHeightRequest="320"
            MaximumHeightRequest="600">
        <Grid RowDefinitions="Auto,Auto,* ,Auto" Padding="0">
            <!-- Header -->
            <StackLayout Grid.Row="0"
                         BackgroundColor="{DynamicResource ShellBackgroundColor}"
                         Padding="12,10">
                <Grid ColumnDefinitions="*,Auto">
                    <Label Grid.Column="0"
                           FontSize="18" FontAttributes="Bold" TextColor="{DynamicResource ShellTitleColor}">
                        <Label.Text>
                            <loc:Translate Resource="FolderResources" Key="ChooseItemTitle" />
                        </Label.Text>
                    </Label>
                    <Button Grid.Column="1"
                            Text="X"
                            FontSize="16"
                            WidthRequest="32"
                            HeightRequest="32"
                            CornerRadius="16"
                            BackgroundColor="Transparent"
                            TextColor="{DynamicResource ShellTitleColor}"
                            Command="{Binding CloseCommand, Source={x:Reference ThisPopup}}" />
                </Grid>
            </StackLayout>

            <!-- Search box -->
            <Grid Grid.Row="1" Padding="12,8">
                <Entry x:Name="SearchEntry"
                       Placeholder="Szukaj..."
                       TextChanged="OnSearchTextChanged"
                       ClearButtonVisibility="WhileEditing" />
            </Grid>

            <!-- List -->
            <ScrollView Grid.Row="2" Padding="8,4">
                <StackLayout x:Name="ItemsHost" Spacing="6" />
            </ScrollView>

            <!-- Footer -->
            <StackLayout Grid.Row="3"
                         BackgroundColor="{DynamicResource ShellBackgroundColor}"
                         Padding="8,6">
                <Grid ColumnDefinitions="*,Auto">
                    <Label Grid.Column="0" FontSize="12" TextColor="{DynamicResource SecondaryText}">
                        <Label.Text>
                            <loc:Translate Resource="FolderResources" Key="SearchHint" />
                        </Label.Text>
                    </Label>
                    <Button Grid.Column="1"
                            FontSize="14"
                            BackgroundColor="Transparent"
                            TextColor="{DynamicResource ShellTitleColor}"
                            Command="{Binding CloseCommand, Source={x:Reference ThisPopup}}">
                        <Button.Text>
                            <loc:Translate Resource="ButtonResources" Key="Cancel" />
                        </Button.Text>
                    </Button>
                </Grid>
            </StackLayout>
        </Grid>
    </Border>
</mct:Popup>